---
title: C-Array
date: 2018-10-08 11:03:57
tags:
---



## 数组

### 数组的定义、初始化

一维

`int arr1d[5];` 5个随机值

`int arr1d[5]={};` 5个0

`int arr1d[5]={1，2};` 不足5个的补0

`int arr1d[]={0，1，2，3，4};` 初始化的5个数

二维

`int arr2d[2][5];`  10个随机值

`int arr2d[2][5]={};` 10个0

`int arr2d[2][5]={{0,1,2,3,4},{5,6,7,8,9}};` 10个初始化的值，都是不足的补0

`int arr2d[2][5]={0,1,2,3,4,5,6,7,8,9};` 同上，也是对的，但不直观

`int arr2d[][5]={{0,1,2,3,4},{5,6,7,8,9}};` **只有第一维的长度可以省略，其他维度的长度在任何情况下都不能省略**

### 数组名

`int arr1d[5];`  arr1d表示一个指向int类型的指针常量

`int arr2d[2][5];`  arr2d表示一个指向（一个包含5个整型元素的数组）的指针

### 下标引用VS间接访问

`arr1d[3]` 等价于 `*(arr1d+3)`

`arr2d[1][3]` 等价于 `*(*(arr2d+1)+3)`

注意：下标引用完全等价于间接访问，下标引用可以作用于任意的指针而不仅仅是数组名，如：`int* p_arr1d = arr1d;`那么`p_arr1d[2]`同样等价于`*(p_arr1d+2)`。同样`2[p_arr1d]`也是合法的，等价于`*(2+p_arr1d)`等价于`*(p_arr1d+2)`等价于`p_arr1d[2]`。

### 指针变量与数组

定义指向数组首地址的指针。

* 一维数组

  `int* p_arr1d = arr1d;` 等价于 `int* p_arr1d = &arr1d[0];`

  间接访问第4个元素：`*(p_arr1d+3)`

* 二维数组

  * `int* p_arr2d = arr2d[0];` 等价于  `int* p_arr2d = &arr2d[0][0];`（注意初始化形式）

    此时通过`*(p_arr2d++)`可以逐个访问数组元素。

    间接访问第2行第4个元素：`*(p_arr2d+1*5+3）`

  * `int (*p_arr2d)[5] = arr2d;`

    此时`*(p_arr2d++)`会逐行在数组中移动。

    间接访问第2行第4个元素：`*(*(p_arr2d+1)+3）`

### 数组名与函数参数

数组名本身是常量不能被修改，但是其作为函数参数时，函数得到的是该指针的一份拷贝，其可以被修改。

``` c
// 函数声明与定义
int func1(int *p_arr1d)
{
    sizeof(p_arr1d); // 得到的是指针的长度而不是数组的长度
    p_arr1d++; // 虽然传递的a是常量，但这里得到的是a的拷贝，可以被修改
}
// 注意二维数组名作为函数参数时，一定要指定第二维的长度
void func2(int (*p_arr2d)[5]); // 注意这里是数组指针

// 函数调用
int a[3]={1,2,3};
func1(a); // 此时a实际上是个指针而不是数组
int b[2][5]={};
func2(b);
```

数组作为形参传递时，函数并不为数组参数分配内存空间，形参只是一个指针。

函数无法知道数组的长度，如果需要数组长度，则必须作为一个显式的参数传递给函数。







### 数组与指针

| 操作   | 一维数组                      | 二维数组                                 | 备注                           |
| ------ | ----------------------------- | ---------------------------------------- | ------------------------------ |
| 定义   | int a[3];<br>int a[]={1,2,3}; | int b\[3\]\[10\];<br>int b\[\]\[10\]={}; | 二维数组中第二维的长度必须指定 |
| 数组名 |                               |                                          |                                |
| 取值   | a[1]                          | a\[0\]\[1\]                              |                                |
| 指针   | int* pa = a;                  | int** pb = b;                            |                                |
|        |                               | int* pb =                                |                                |
|        |                               |                                          |                                |
|        |                               |                                          |                                |
|        |                               |                                          |                                |





``` c
int matrix[3][10];

```





## 常见疑问

### 定义数组时能不能使用变量来指定数组长度？

在主函数以及子函数中都可以用变量来指定数组的长度。

``` C
// 不能使用变量
int n1 = 10;  // C++中可以使用const修饰int使n1变成常量
int arr1[n1]; // 不定义成全局变量
int main()
{
    // 可以使用变量
    int n2 = 10;
    int arr2[n2]; // 和子函数中的变量一样储存在栈中
}
```



### 指针比下标的效率更高吗？

结论：下标绝不会比指针更有效率，但指针有时会比下标更有效率。 